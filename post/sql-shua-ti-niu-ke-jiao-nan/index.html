<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>SQL刷题-牛客-较难 | maktubの圆</title>

<link rel="shortcut icon" href="https://AnonymityToAll.github.io/favicon.ico?v=1597063259188">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://AnonymityToAll.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>

<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            maktubの圆
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            标签
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
        </div>
    </div>
</nav>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    SQL刷题-牛客-较难
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2020-08-06 ·
                    </time>
                    
                        <a href="https://AnonymityToAll.github.io/tag/Od3QAJkqt/" class="post-tags">
                            # 数据分析面试
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="牛客网题目之中等">牛客网题目之中等</h1>
<h5 id="t17">T17</h5>
<pre><code class="language-sql">select emp_no, salary
from salaries
where to_date = '9999-01-01'
order by salary desc
limit 1, 1
</code></pre>
<blockquote>
<p>没有加desc，默认是单增的，所以出现了问题</p>
</blockquote>
<h5 id="t18">T18</h5>
<pre><code class="language-sql">select e.emp_no, s.salary, e.last_name, e.first_name
from employees as e inner join salaries as s 
on e.emp_no = s.emp_no
where s.to_date='9999-01-01'
order by salary desc
limit 1, 1
</code></pre>
<blockquote>
<p>没有加where<br>
没有加desc<br>
题目要求不用orderby 然而我用了</p>
</blockquote>
<pre><code class="language-sql">select e.emp_no, max(s.salary), e.last_name, e.first_name
from employees e inner join salaries s on e.emp_no = s.emp_no
where to_date='9999-01-01'
and salary &lt; (select max(s.salary)from salaries s 
                    where s.to_date='9999-01-01')
</code></pre>
<blockquote>
<p>这是不用order by的版本</p>
</blockquote>
<h5 id="t19">T19</h5>
<p>错误示例：</p>
<pre><code class="language-sql">select e.last_name, e.first_name, depa.dept_name
from employees as e 
left join departments as depa
on depa.dept_no = dept.dep_no
left join dept_emp as dept
on dept.emp_no = e.emp_no
</code></pre>
<blockquote>
<p>错误有两个地方：</p>
<ul>
<li>
<p>dept再没有声明之前就使用了，即需要调换</p>
<pre><code class="language-sql">left join departments as depa
on depa.dept_no = dept.dep_no
</code></pre>
<pre><code class="language-sql">left join dept_emp as dept
on dept.emp_no = e.emp_no
</code></pre>
<p>的位置</p>
</li>
<li>
<p>dept.dept_no写成了dept.dep_no</p>
</li>
</ul>
</blockquote>
<p>正确示例：</p>
<pre><code class="language-sql">select e.last_name, e.first_name, depa.dept_name
from employees as e 
left join dept_emp as dept
on dept.emp_no = e.emp_no
left join departments as depa
on depa.dept_no = dept.dept_no
</code></pre>
<h5 id="t20">T20</h5>
<pre><code class="language-sql">select max(salary)-min(salary) as growth
from salaries
where emp_no = 10001
group by emp_no
</code></pre>
<blockquote>
<p>一次通过！！！</p>
</blockquote>
<h5 id="t21">T21</h5>
<pre><code class="language-sql">select t1.emp_no, t1.salary-t2.salary as growth
from employees as e 
join (select emp_no, salary from salaries
     where to_date='9999-01-01') as t1
on t1.emp_no = e.emp_no
join (select e.emp_no, s.salary from salaries as s 
     join employees as e on e.emp_no = s.emp_no
     where s.from_date=e.hire_date) as t2
on t2.emp_no = e.emp_no
order by growth asc 
</code></pre>
<h5 id="t22">T22</h5>
<p>错误示例：</p>
<pre><code class="language-sql">select de.dept_no, d.dept_name, count(s.emp_no) as sum
from departments as d 
join dept_emp as de on d.dept_no = de.dept_no
join salaries as s on s.emp_no = de.emp_no
</code></pre>
<p>正确示例：</p>
<pre><code class="language-sql">select de.dept_no, d.dept_name, count(s.emp_no) as sum
from departments as d 
join dept_emp as de on d.dept_no = de.dept_no
join salaries as s on s.emp_no = de.emp_no
group by de.dept_no
</code></pre>
<p>问的是部门的记录总共有多少，所以要按照部门分组</p>
<h5 id="t23">T23</h5>
<pre><code class="language-sql">select emp_no,salary,dense_rank() over (order by salary desc) as rank
from salaries
where to_date='9999-01-01'
</code></pre>
<p><a href="https://www.cnblogs.com/scwbky/p/9558203.html">rank() over类别</a></p>
<blockquote>
<p>这里不太懂怎么实现在salary相同的时候使用emp_no排序的</p>
</blockquote>
<h5 id="t24">T24</h5>
<p>错误示例：</p>
<pre><code class="language-sql">select m.dept_no, m.emp_no, s.salary 
from dept_manager as m 
join employees as e 
on m.emp_no = e.emp_no
join salaries as s 
on s.emp_no = e.emp_no
where s.to_date = '9999-01-01' and m.emp_no != e.emp_no
</code></pre>
<p>正确示例：</p>
<pre><code class="language-sql">select de.dept_no, de.emp_no, s.salary
from dept_emp as de join employees as e 
on de.emp_no = e.emp_no
join salaries as s 
on de.emp_no = s.emp_no
where s.to_date='9999-01-01' and e.emp_no not in (
select emp_no from dept_manager)
</code></pre>
<blockquote>
<p>不能用dept_manager里的东西 所以给的四个表都是有用的 不是说可以瞎用的</p>
</blockquote>
<h5 id="t25font-face微软雅黑-size4-colorff0000-标红font">T25<font face="微软雅黑" size=4 color=#FF0000 >标红</font></h5>
<p>错误示例：</p>
<pre><code class="language-sql">select d.emp_no, m.emp_no, emp_salary, manager_salary
from (select d.dept_no, d.emp_no, s.salary as emp_salary
from dept_emp as d join salaries as s 
on d.emp_no = s.emp_no
where s.to_date = '9999-01-01' and m.to_date = '9999-01-01') 
as t1
join (select d.dept_no, m.emp_no, s.salary as manager_salary
from dept_manager as m join salaries as s 
on m.emp_no = s.emp_no
where s.to_date = '9999-01-01' and m.to_date = '9999-01-01')
as t2
on t1.emp_no = t2.emp_no
where emp_salary &gt; manager_salary
</code></pre>
<p>正确示例：</p>
<pre><code class="language-sql">select t1.emp_no,manager_no,emp_salary,manager_salary
from(
    select dept_no,d1.emp_no,salary as emp_salary
    from dept_emp as d1 inner join salaries as s on d1.emp_no=s.emp_no
    where d1.to_date='9999-01-01' and s.to_date='9999-01-01'
    ) t1
inner join(
    select dept_no,d2.emp_no as manager_no,salary as manager_salary
    from dept_manager as d2 inner join salaries as s on d2.emp_no=s.emp_no
    where d2.to_date='9999-01-01' and s.to_date='9999-01-01'
    ) t2
on t1.dept_no=t2.dept_no
where t1.emp_salary&gt;t2.manager_salary;
</code></pre>
<h5 id="t26">T26</h5>
<pre><code class="language-sql">select d.dept_no,d.dept_name,t.title,count(*)
from dept_emp de
inner join departments as d
on de.dept_no = d.dept_no
inner join titles as t
on de.emp_no=t.emp_no
where de.to_date = '9999-01-01'
and t.to_date = '9999-01-01'
group by d.dept_no,t.title
</code></pre>
<blockquote>
<p>原来可以直接按照两个元素分组</p>
</blockquote>
<h5 id="t27">T27</h5>
<pre><code class="language-sql">select s2.emp_no , s2.from_date , (s2.salary-s1.salary) as salary_growth
from salaries s1 join salaries s2 on s1.emp_no = s2.emp_no
and s2.from_date = s1.to_date 
where s2.salary-s1.salary &gt; 5000
order by salary_growth desc
</code></pre>
<blockquote>
<p>没做出来</p>
<p>因为这个题要求把每年工资涨幅超过5000的人列出来，纠结于怎么体现每年和工资涨幅怎么体现<br>
看了别人的代码，其实主要还是两个地方，<br>
一个，是把一个表作为两个表来链接的思想。<br>
一个，是s2.from_date = s1.to_date就代表了每年工资有变化的人。再加上下面的&quot;&gt;5000&quot;便体现了题目要找的东西</p>
</blockquote>
<h5 id="t28">T28</h5>
<p>错误示例：</p>
<pre><code class="language-sql">select c.name, count(f.film_id)
from category as c inner join film_category as fc
on c.category_id = fc.category_id
inner join film as f 
on f.film_id = fc.film_id
where f.description like &quot;*robot*&quot; and count(f.film_id)&gt;=5
group by c.name
</code></pre>
<blockquote>
<p>第二个count，count的是筛选之后的部分，所以与题意是不符的。</p>
</blockquote>
<p>正确示例：</p>
<pre><code class="language-sql">SELECT c.name, COUNT(fc.film_id)
FROM film AS f, film_category AS fc, category AS c
WHERE f.description LIKE '%robot%'
AND f.film_id = fc.film_id
AND c.category_id = fc.category_id
AND c.category_id IN (select category_id
FROM film_category
GROUP BY category_id
HAVING count(film_id)&gt;=5)
GROUP BY c.name;
</code></pre>
<blockquote>
<p>不要问，问就是没做出来...，老想着inner join  但其实不需要</p>
</blockquote>
<h5 id="t29">T29</h5>
<pre><code class="language-sql">select f.film_id, f.title
from film as f left join film_category as fc
on f.film_id = fc.film_id
where fc.category_id is NULL
</code></pre>
<blockquote>
<p>哈哈哈 做出来了<br>
需要注意的是最后判断空用 is null，不是&quot;=NULL&quot;，也不是“=&quot;NULL&quot;”</p>
</blockquote>
<h5 id="t30">T30</h5>
<pre><code class="language-sql">select f.title, f.description
from film as f inner join film_category as fc
on f.film_id = fc.film_id
inner join category as c 
on c.category_id = fc.category_id
where c.name = &quot;Action&quot;
</code></pre>
<blockquote>
<p>一遍出结果（whisper：没用它要求的方法）</p>
</blockquote>
<h5 id="t31">T31</h5>
<pre><code class="language-sql">explain select * from employees
</code></pre>
<blockquote>
<p>没看懂题目，因为确实也没学过explain</p>
</blockquote>
<h5 id="t32">T32</h5>
<pre><code class="language-sql">select last_name || ' ' || first_name as Name
from employees
</code></pre>
<h5 id="t33">T33</h5>
<p>我的没有通过的：</p>
<pre><code class="language-sql">create table actor
(
    actor_id smallint(5),
    first_name varchar(45),
    last_name varchar(45),
    last_update timestamp
)
</code></pre>
<p>别人的通过了的：</p>
<pre><code class="language-sql">create table  if not exists actor(
    actor_id smallint(5) not null,
    first_name varchar(45) not null,
    last_name varchar(45) not null,
    last_update timestamp not null default (datetime('now', 'localtime')),
    primary key(actor_id)
)
</code></pre>
<blockquote>
<p>其中if not exists是为了增加代码的鲁棒性<br>
primary key是指的主键列，每个表都需要有一个且仅有一个主键列。<br>
主键列的值不能为空。<br>
timestamp那一列需要初始化</p>
</blockquote>
<h5 id="t34">T34</h5>
<pre><code class="language-sql">INSERT INTO actor (actor_id, first_name, last_name, last_update)
VALUES
(1, 'PENELOPE', 'GUINESS', '2006-02-15 12:34:33'),
(2, 'NICK', 'WAHLBERG', '2006-02-15 12:34:33')
</code></pre>
<h5 id="t35">T35</h5>
<pre><code class="language-SQL">INSERT OR IGNORE INTO actor (actor_id, first_name, last_name, last_update)
VALUES
('3', 'ED', 'CHASE', '2006-02-15 12:34:33')
</code></pre>
<h5 id="t36">T36</h5>
<pre><code class="language-SQL">create table actor_name  as
select first_name,last_name from actor
</code></pre>
<h5 id="t37">T37</h5>
<pre><code class="language-sql">create unique index uniq_idx_firstname on actor(first_name);
create index idx_lastname on actor(last_name);
</code></pre>
<h5 id="t38">T38</h5>
<pre><code class="language-sql">CREATE VIEW actor_name_view(first_name_v, last_name_v) AS
select first_name, last_name
from actor
</code></pre>
<h5 id="t39">T39</h5>
<pre><code class="language-sql">SELECT * FROM salaries INDEXED BY idx_emp_no WHERE emp_no = 10005
</code></pre>
<h5 id="t40">T40</h5>
<pre><code class="language-sql">ALTER TABLE actor ADD COLUMN create_date datetime not null default('0000-00-00 00:00:00');
</code></pre>
<h5 id="t41">T41</h5>
<pre><code class="language-sql">create trigger audit_log after insert on employees_test
begin
    insert into audit values(new.id,new.name);
end
</code></pre>
<h5 id="t42">T42</h5>
<p>错误示例：</p>
<pre><code class="language-sql">select min(id) 
from titles_test
group by emp_no
</code></pre>
<p>正确示例：</p>
<pre><code class="language-sql">DELETE FROM titles_test WHERE id NOT IN
(SELECT MIN(id) FROM titles_test GROUP BY emp_no)
</code></pre>
<h5 id="t43">T43</h5>
<pre><code class="language-sql">UPDATE titles_test SET to_date = NULL, from_date = '2001-01-01'WHERE to_date = '9999-01-01';
</code></pre>
<h5 id="t44">T44</h5>
<pre><code class="language-sql">UPDATE titles_test SET emp_no = REPLACE(emp_no,10001,10005) WHERE id = 5
</code></pre>
<h5 id="t45">T45</h5>
<pre><code class="language-sql">alter table titles_test rename to titles_2017;
</code></pre>
<h5 id="t46">T46</h5>
<pre><code class="language-sql">drop table audit;
create table audit(
    EMP_no int not null,
    create_date datetime not null,
    foreign key(EMP_no)
    references employees_test(ID)
);
</code></pre>
<h3 id=""></h3>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://AnonymityToAll.github.io/post/pin-duo-duo-bi-shi-zhun-bei-yi-sql/" class="post-title gt-a-link">
                    SQL刷题-牛客-中等
                </a>
            </div>
        

        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: '',
		appKey: '',
		avatar: '',
		pageSize: 5,
		recordIp: false,
		placeholder: 'Just Go Go',
		visitor: false,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">向死而生</div>
    <div class="social-container">
        
            
                <a href="https://github.com/AnonymityToAll" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://AnonymityToAll.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
    hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
